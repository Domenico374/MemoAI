<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memo AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- DOCX preview -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <!-- PDF preview -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      var lib = window.pdfjsLib || (window['pdfjs-dist/build/pdf'] || null);
      if (lib && lib.GlobalWorkerOptions) {
        lib.GlobalWorkerOptions.workerSrc =
          'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        window.pdfjsLib = lib;
      }
    });
  </script>
</head>
<body class="text-slate-800 bg-blue-50 min-h-screen">
  <!-- Navbar sticky -->
  <header class="sticky top-0 z-30 border-b bg-white/90 backdrop-blur shadow">
    <div class="max-w-4xl mx-auto px-4 py-2 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <span class="text-blue-600 font-bold text-xl flex items-center gap-1">
          <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" /></svg>
          Memo AI
        </span>
        <span id="navStatusApi" class="text-xs px-3 py-1 ml-3 rounded-full font-bold bg-emerald-100 text-emerald-700">checking…</span>
      </div>
      <nav class="hidden md:flex gap-6">
        <a href="#" class="text-slate-500 hover:text-blue-600 font-semibold transition">Home</a>
        <a href="#" class="text-slate-500 hover:text-blue-600 font-semibold transition">Guida</a>
        <a href="#" class="text-slate-500 hover:text-blue-600 font-semibold transition">Info</a>
      </nav>
    </div>
  </header>
  <!-- Toggles tema -->
  <div class="max-w-4xl mx-auto px-4 py-3 flex justify-end gap-2">
    <button data-theme="ocean"  class="px-3 py-1 rounded-full bg-blue-100 text-blue-700 hover:bg-blue-200 font-semibold">Ocean</button>
    <button data-theme="sunset" class="px-3 py-1 rounded-full bg-rose-100 text-rose-700 hover:bg-rose-200 font-semibold">Sunset</button>
    <button data-theme="mint"   class="px-3 py-1 rounded-full bg-emerald-100 text-emerald-700 hover:bg-emerald-200 font-semibold">Mint</button>
    <button data-theme="aqua"   class="px-3 py-1 rounded-full bg-teal-100 text-teal-700 hover:bg-teal-200 font-semibold">Aqua</button>
  </div>

  <div class="max-w-4xl mx-auto p-6">

    <!-- Sezione carica file -->
    <section class="bg-white rounded-2xl shadow-lg p-6 mb-6 border border-blue-50">
      <div class="flex items-center justify-between mb-3">
        <div class="flex gap-2 items-center">
          <h2 class="text-lg font-semibold">Carica file</h2>
          <span id="fileCountBadge" class="text-xs px-3 py-1 rounded-full font-bold bg-blue-100 text-blue-800 ml-2 transition">0 in coda</span>
        </div>
        <button id="btnUpload" type="button"
          class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-full px-5 py-2 shadow-lg text-base transition">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5-5m0 0l5 5m-5-5v12"/>
          </svg>
          Seleziona file
        </button>
      </div>
      <div id="dropArea"
        class="bg-blue-50 border-2 border-dashed border-blue-300 rounded-xl py-8 text-center text-blue-600 font-semibold min-h-[80px] flex items-center justify-center hover:bg-blue-100 transition">
        <svg class="w-7 h-7 inline mr-2 -mt-1" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
        </svg>
        Trascina qui i file oppure clicca su "Seleziona file"
      </div>
      <ul id="queue" class="mt-4 space-y-2 text-sm"></ul>
      <input id="uploader" type="file" multiple accept=".txt,.md,.pdf,.docx,.mp3,.m4a,.wav,.ogg,.webm,.mp4,.mov,.mkv" class="hidden" />
    </section>

    <!-- Anteprima -->
    <section class="bg-white rounded-2xl shadow p-5 mb-6">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10l4.553 2.276A2 2 0 0121 14.118V19a2 2 0 01-2 2H5a2 2 0 01-2-2v-4.882a2 2 0 01 1.447-1.842L9 10"/>
          </svg>
          Anteprima
        </h2>
        <button id="btnClearPreview"
          class="flex items-center gap-2 bg-gray-200 hover:bg-gray-300 text-slate-800 font-semibold rounded-full px-4 py-2 transition">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          Pulisci anteprima
        </button>
      </div>
      <div id="preview" class="prose max-w-none border border-slate-200 rounded-xl p-4 bg-slate-50 text-sm">
        <p class="text-slate-500">L’anteprima comparirà qui…</p>
      </div>
    </section>

    <!-- Appunti -->
    <section class="bg-white rounded-2xl shadow p-5 mb-6">
      <h2 class="text-lg font-semibold mb-3 flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 20h9"/>
        </svg>
        Appunti
      </h2>
      <textarea id="notes" rows="10"
        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y font-mono text-base"
        placeholder="Appunti trascritti o estratti…"></textarea>
      <div class="mt-4 flex flex-wrap gap-2">
        <button id="btnClean" class="flex items-center gap-2 bg-gray-200 hover:bg-gray-300 text-slate-800 font-semibold rounded-full px-4 py-2 transition">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 6h18M9 6V4a1 1 0 112 0v2m5 0v2M6 6V4m12 2v2"/>
          </svg>
          Pulizia
        </button>
        <button id="btnMinutesAI" class="flex items-center gap-2 bg-indigo-500 hover:bg-indigo-600 text-white font-semibold rounded-full px-4 py-2 transition">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19 14l-7 7-7-7"/>
          </svg>
          Verbale
        </button>
        <button id="btnTranscribe" class="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white font-semibold rounded-full px-4 py-2 transition">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 19V6h6v13"/>
          </svg>
          Trascrizione
        </button>
        <button id="btnGenerate" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-full px-4 py-2 transition">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M12 5l7 7-7 7"/>
          </svg>
          Genera verbale
        </button>
        <button id="btnReset" class="flex items-center gap-2 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-full px-4 py-2 transition">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          Resettare
        </button>
      </div>
    </section>

    <!-- Analisi intelligente -->
    <section class="bg-white rounded-2xl shadow p-5 mb-6">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405M19 15.595 13.5 10.08"/>
          </svg>
          Analisi intelligente
        </h2>
        <div class="flex flex-wrap gap-2">
          <button id="btnSummarize" class="flex items-center gap-2 bg-cyan-500 hover:bg-cyan-600 text-white font-semibold rounded-full px-4 py-2 text-xs transition">Riassunto</button>
          <button id="btnHighlights" class="flex items-center gap-2 bg-fuchsia-500 hover:bg-fuchsia-600 text-white font-semibold rounded-full px-4 py-2 text-xs transition">Punti salienti</button>
          <button id="btnTodos" class="flex items-center gap-2 bg-amber-400 hover:bg-amber-500 text-slate-800 font-semibold rounded-full px-4 py-2 text-xs transition">To-Do</button>
          <button id="btnSuggestTags" class="flex items-center gap-2 bg-teal-500 hover:bg-teal-600 text-white font-semibold rounded-full px-4 py-2 text-xs transition">Suggerisci tag</button>
        </div>
      </div>
      <div class="grid gap-4 md:grid-cols-2">
        <div class="border border-slate-200 rounded-xl p-3 bg-slate-50">
          <h3 class="font-medium mb-2">Riassunto</h3>
          <div id="summaryBox" class="text-sm text-slate-800 whitespace-pre-wrap">—</div>
        </div>
        <div class="border border-slate-200 rounded-xl p-3 bg-slate-50">
          <h3 class="font-medium mb-2">Punti salienti</h3>
          <div id="highlightsBox" class="text-sm text-slate-800 whitespace-pre-wrap">—</div>
        </div>
        <div class="border border-slate-200 rounded-xl p-3 bg-slate-50">
          <h3 class="font-medium mb-2">To-Do</h3>
          <div id="todoBox" class="text-sm text-slate-800 whitespace-pre-wrap">—</div>
        </div>
        <div class="border border-slate-200 rounded-xl p-3 bg-slate-50">
          <h3 class="font-medium mb-2">Tag suggeriti</h3>
          <div id="tagsBox" class="text-sm text-slate-800 whitespace-pre-wrap">—</div>
        </div>
      </div>
    </section>

    <!-- Verbale -->
    <section class="bg-white rounded-2xl shadow p-5">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16 5v14M8 5v14"/>
          </svg>
          Verbale
        </h2>
        <div class="flex gap-2">
          <button id="btnCopy" class="flex items-center gap-2 bg-gray-200 hover:bg-gray-300 text-slate-800 font-semibold rounded-full px-4 py-2 transition">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 16h8M8 12h8M8 8h8"/>
            </svg>
            Copiare
          </button>
          <button id="btnDownload" class="flex items-center gap-2 bg-gray-200 hover:bg-gray-300 text-slate-800 font-semibold rounded-full px-4 py-2 transition">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 20h12M12 4v16"/>
            </svg>
            Scarica .md
          </button>
        </div>
      </div>
      <pre id="result" class="whitespace-pre-wrap text-sm leading-6 text-slate-800">Il verbale comparirà qui…</pre>
    </section>
  </div>
  <script>
    // Tema toggle
    (function(){
      const saved = localStorage.getItem('memoai_theme') || 'aqua';
      document.body.classList.remove('theme-ocean','theme-sunset','theme-mint','theme-aqua');
      document.body.classList.add('theme-'+saved);
      document.querySelectorAll('[data-theme]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const t = btn.dataset.theme;
          document.body.classList.remove('theme-ocean','theme-sunset','theme-mint','theme-aqua');
          document.body.classList.add('theme-'+t);
          localStorage.setItem('memoai_theme', t);
        });
      });
    })();
    // Badge stato API
    async function health(){
      var badge = document.getElementById('navStatusApi');
      try {
        var u = await fetch('/api/upload', { method: 'OPTIONS' });
        var e = await fetch('/api/extract', { method: 'OPTIONS' });
        if (u.ok && e.ok) {
          badge.textContent = 'API ok';
          badge.className = "text-xs px-3 py-1 ml-3 rounded-full font-bold bg-emerald-100 text-emerald-700";
        } else {
          badge.textContent = 'API parziali';
          badge.className = "text-xs px-3 py-1 ml-3 rounded-full font-bold bg-amber-100 text-amber-700 animate-pulse";
        }
      } catch(err){
        badge.textContent = 'API offline';
        badge.className = "text-xs px-3 py-1 ml-3 rounded-full font-bold bg-rose-100 text-rose-700 animate-pulse";
      }
    }
    health();
    // Drop-area evidenziata
    (()=>{
      const dropArea = document.getElementById('dropArea');
      const uploader = document.getElementById('uploader');
      if (!dropArea || !uploader) return;
      ['dragenter','dragover'].forEach(ev =>
        dropArea.addEventListener(ev, e => { e.preventDefault(); dropArea.classList.add('bg-blue-100', 'border-blue-400'); })
      );
      ['dragleave','drop'].forEach(ev =>
        dropArea.addEventListener(ev, e => { e.preventDefault(); dropArea.classList.remove('bg-blue-100', 'border-blue-400'); })
      );
      dropArea.addEventListener('drop', e => {
        const files = [...(e.dataTransfer?.files||[])];
        if (files.length && typeof handleFiles === "function") handleFiles(files);
      });
    })();
    // ...inserisci qui il tuo JS di funzioni per i pulsanti e caricamento
  </script>
</body>
</html>
