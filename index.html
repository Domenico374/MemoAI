<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Memo AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- DOCX preview (client-side) -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <!-- PDF preview (render first page) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      var lib = window.pdfjsLib || (window['pdfjs-dist/build/pdf'] || null);
      if (lib && lib.GlobalWorkerOptions) {
        lib.GlobalWorkerOptions.workerSrc =
          'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        window.pdfjsLib = lib;
      }
    });
  </script>
  <style>
    /* ====== Background pastello con temi ====== */
    body{
      background:#f5f7fb; min-height:100vh; position:relative;
    }
    body::before{
      content:""; position:fixed; inset:0; z-index:-1; pointer-events:none;
      background:
        radial-gradient(600px 360px at -5% -10%, var(--bg1) 0%, transparent 60%),
        radial-gradient(720px 420px at 105% -10%, var(--bg2) 0%, transparent 60%),
        radial-gradient(800px 520px at 50% 110%, var(--bg3) 0%, transparent 60%);
      filter: blur(12px) saturate(110%); opacity:.55;
    }
    /* default (ocean) */
    :root{ --bg1:#e0f2fe; --bg2:#e9d5ff; --bg3:#fce7f3; }
    .theme-ocean  { --bg1:#e0f2fe; --bg2:#e9d5ff; --bg3:#fce7f3; }
    .theme-sunset { --bg1:#fde68a; --bg2:#fca5a5; --bg3:#a7f3d0; }
    .theme-mint   { --bg1:#bbf7d0; --bg2:#a7f3d0; --bg3:#bfdbfe; }

    .prose :where(h1,h2,h3){margin:.25rem 0 .5rem}

    /* ====== Pulsanti colorati + stati ====== */
    :root{
      --radius: 10px;
      --muted: #e2e8f0;     /* Pulizia */
      --secondary: #6366f1; /* Verbale */
      --success: #10b981;   /* Trascrizione */
      --primary: #2563eb;   /* Genera verbale */
      --danger: #ef4444;    /* Resettare */
      --cyan:    #06b6d4;   /* Riassunto */
      --fuchsia: #d946ef;   /* Punti salienti */
      --amber:   #f59e0b;   /* To-Do */
      --teal:    #14b8a6;   /* Suggerisci tag */
    }
    .btn{
      -webkit-tap-highlight-color: transparent;
      appearance: none;
      border: 1px solid transparent;
      border-radius: var(--radius);
      padding: 8px 14px;
      font: 600 14px/1 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      cursor: pointer;
      transition: transform .06s ease, box-shadow .2s ease, background-color .2s ease, opacity .2s ease;
      display: inline-flex; align-items: center; gap: .5rem;
      box-shadow: 0 1px 0 rgba(15,23,42,.06);
    }
    .btn:active{ transform: translateY(1px) scale(.98); }
    .btn:focus-visible{ outline: 0; box-shadow: 0 0 0 3px rgba(37,99,235,.25); }
    .btn[disabled]{ opacity:.55; cursor:not-allowed; }
    .btn--muted{     background: var(--muted);     color:#0b1220; } .btn--muted:hover{ filter: brightness(.97); }
    .btn--secondary{ background: var(--secondary); color:#fff; }   .btn--secondary:hover{ filter: brightness(.95); }
    .btn--success{   background: var(--success);   color:#fff; }   .btn--success:hover{ filter: brightness(.95); }
    .btn--primary{   background: var(--primary);   color:#fff; }   .btn--primary:hover{ filter: brightness(.95); }
    .btn--danger{    background: var(--danger);    color:#fff; }   .btn--danger:hover{ filter: brightness(.95); }
    .btn--cyan{      background: var(--cyan);      color:#fff; }   .btn--cyan:hover{ filter: brightness(.95); }
    .btn--fuchsia{   background: var(--fuchsia);   color:#fff; }   .btn--fuchsia:hover{ filter: brightness(.95); }
    .btn--amber{     background: var(--amber);     color:#0b1220;} .btn--amber:hover{ filter: brightness(.97); }
    .btn--teal{      background: var(--teal);      color:#fff; }   .btn--teal:hover{ filter: brightness(.95); }

    .btn.is-active{ box-shadow: 0 0 0 3px rgba(16,185,129,.2), 0 6px 14px rgba(2,6,23,.12); }
    .btn.is-loading{ position: relative; pointer-events:none; }
    .btn.is-loading::after{
      content:""; width: 1em; height: 1em; border-radius: 999px;
      border: 2px solid currentColor; border-top-color: transparent;
      position:absolute; right: 10px; top: 50%; transform: translateY(-50%);
      animation: spin .9s linear infinite;
    }
    @keyframes spin{ to{ transform: translateY(-50%) rotate(360deg) } }

    /* pill tiny buttons */
    .pill{ font:600 12px/1 system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; }
  </style>
</head>
<body class="text-slate-800 theme-ocean">
  <div class="max-w-4xl mx-auto p-6">
    <!-- Header -->
    <header class="mb-6 flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <div>
          <h1 class="text-3xl font-bold">Memo AI</h1>
          <p class="text-sm text-slate-600">Upload file → Trascrizione / Estrazione → Formattazione</p>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <span id="healthBadge" class="text-xs px-2.5 py-1 rounded-full bg-slate-200 text-slate-700">checking…</span>
        <!-- Theme toggle -->
        <div class="hidden sm:flex items-center gap-1 ml-2">
          <button data-theme="ocean"  class="pill px-2.5 py-1 rounded-full bg-blue-100 text-blue-700 hover:bg-blue-200">Ocean</button>
          <button data-theme="sunset" class="pill px-2.5 py-1 rounded-full bg-rose-100 text-rose-700 hover:bg-rose-200">Sunset</button>
          <button data-theme="mint"   class="pill px-2.5 py-1 rounded-full bg-emerald-100 text-emerald-700 hover:bg-emerald-200">Mint</button>
        </div>
      </div>
    </header>

    <!-- Upload -->
    <section class="bg-white rounded-2xl shadow p-5 mb-6">
      <div class="flex items-start justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold">Carica file</h2>
          <p class="text-xs text-slate-500 mt-1">
            Suggerimento: per file &gt; 4.5 MB usare versioni ridotte. I PDF scansionati richiederanno OCR.
          </p>
        </div>
        <button id="btnUpload" type="button" class="px-3 py-2 rounded-lg text-sm bg-slate-100 hover:bg-slate-200">Seleziona file</button>
      </div>

      <ul id="queue" class="mt-4 space-y-2 text-sm"></ul>
      <input id="uploader" type="file" multiple
             accept=".txt,.md,.pdf,.docx,.mp3,.m4a,.wav,.ogg,.webm,.mp4,.mov,.mkv"
             class="hidden" />
    </section>

    <!-- Anteprima -->
    <section class="bg-white rounded-2xl shadow p-5 mb-6">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Anteprima</h2>
        <button id="btnClearPreview" class="px-3 py-2 rounded-lg text-sm bg-slate-100 hover:bg-slate-200">Pulisci anteprima</button>
      </div>
      <div id="preview" class="prose max-w-none border border-slate-200 rounded-xl p-4 bg-slate-50 text-sm">
        <p class="text-slate-500">L’anteprima comparirà qui…</p>
      </div>
    </section>

    <!-- Appunti -->
    <section class="bg-white rounded-2xl shadow p-5 mb-6">
      <h2 class="text-lg font-semibold mb-3">Appunti</h2>
      <textarea id="notes" rows="12"
        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
        placeholder="Appunti trascritti o estratti…"></textarea>

      <div class="mt-4 flex flex-wrap gap-2">
        <button id="btnClean"       class="btn btn--muted">Pulizia</button>
        <button id="btnMinutesAI"   class="btn btn--secondary">Verbale</button>
        <button id="btnTranscribe"  class="btn btn--success">Trascrizione</button>
        <button id="btnGenerate"    class="btn btn--primary">Genera verbale</button>
        <button id="btnReset"       class="btn btn--danger">Resettare</button>
      </div>
    </section>

    <!-- Analisi intelligente -->
    <section class="bg-white rounded-2xl shadow p-5 mb-6">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Analisi intelligente</h2>
        <div class="flex flex-wrap gap-2">
          <button id="btnSummarize"   class="btn btn--cyan">Riassunto</button>
          <button id="btnHighlights"  class="btn btn--fuchsia">Punti salienti</button>
          <button id="btnTodos"       class="btn btn--amber">To-Do</button>
          <button id="btnSuggestTags" class="btn btn--teal">Suggerisci tag</button>
        </div>
      </div>

      <div class="grid gap-4 md:grid-cols-2">
        <div class="border border-slate-200 rounded-xl p-3 bg-slate-50">
          <h3 class="font-medium mb-2">Riassunto</h3>
          <div id="summaryBox" class="text-sm text-slate-800 whitespace-pre-wrap">—</div>
        </div>
        <div class="border border-slate-200 rounded-xl p-3 bg-slate-50">
          <h3 class="font-medium mb-2">Punti salienti</h3>
          <div id="highlightsBox" class="text-sm text-slate-800 whitespace-pre-wrap">—</div>
        </div>
        <div class="border border-slate-200 rounded-xl p-3 bg-slate-50">
          <h3 class="font-medium mb-2">To-Do</h3>
          <div id="todoBox" class="text-sm text-slate-800 whitespace-pre-wrap">—</div>
        </div>
        <div class="border border-slate-200 rounded-xl p-3 bg-slate-50">
          <h3 class="font-medium mb-2">Tag suggeriti</h3>
          <div id="tagsBox" class="text-sm text-slate-800 whitespace-pre-wrap">—</div>
        </div>
      </div>
    </section>

    <!-- Verbale -->
    <section class="bg-white rounded-2xl shadow p-5">
      <div class="flex items-center justify-between mb-3">
        <h2 cla
