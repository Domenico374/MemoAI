<!doctype html>
<html lang="it">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Upload Test – Vercel Blob</title>
<style>
  body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:720px;margin:40px auto;padding:0 16px}
  h1{margin:0 0 24px}
  pre{background:#f6f6f6;padding:12px;border-radius:8px;white-space:pre-wrap;word-break:break-word;min-height:56px}
  button{padding:8px 12px;border-radius:8px;border:1px solid #ddd;cursor:pointer;margin-left:8px}
</style>

<h1>Upload Test – Vercel Blob</h1>

<input id="file" type="file" />
<button id="go" type="button">Carica</button>

<h3>Risposta</h3>
<pre id="out">—</pre>

<script>
const out = document.getElementById('out');
const log = (l='') => (out.textContent += l + '\n');

document.getElementById('go').onclick = async () => {
  const f = document.getElementById('file').files[0];
  if (!f) return alert('Seleziona un file');
  out.textContent = '1) chiedo l’URL...\n';

  try {
    const r = await fetch('/api/blob-url', {
      method: 'POST',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify({ filename: f.name, contentType: f.type || 'application/octet-stream' })
    });
    const text = await r.text();
    log(`/api/blob-url → HTTP ${r.status}`);
    log(text);

    if (!r.ok) return;

    let j; try { j = JSON.parse(text); } catch { j = {}; }
    if (!j.ok || !j.uploadUrl) { log('Risposta senza uploadUrl, stop.'); return; }

    log('\n2) carico il file...');
    const up = await fetch(j.uploadUrl, { method: 'POST', body: f });
    const upText = await up.text();
    log(`upload → HTTP ${up.status}`);
    log(upText);

    if (up.ok) {
      const publicUrl = 'https://blob.vercel-storage.com' + (j.blobPath || '');
      log(`\nFatto! Percorso: ${j.blobPath || '(sconosciuto)'}\nURL (stima): ${publicUrl}`);
    }
  } catch (e) {
    log('ERRORE JS: ' + (e && e.message ? e.message : e
