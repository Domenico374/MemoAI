<!doctype html>
<meta charset="utf-8"/>
<title>Upload Test</title>
<h1>Upload Test – API</h1>

<input type="file" id="file">
<button id="go">Carica</button>

<h3>Risposta</h3>
<pre id="out" style="background:#f5f5f5;padding:12px;border-radius:8px;white-space:pre-wrap;"></pre>

<script>
const out = document.getElementById('out');
function log(...a){ out.textContent += a.join(' ') + "\n"; }

document.getElementById('go').onclick = async () => {
  out.textContent = '';
  const file = document.getElementById('file').files[0];
  if (!file) { log('Seleziona un file'); return; }

  // 1) /api/upload
  const fd = new FormData();
  fd.append('file', file, file.name);
  fd.append('contentType', file.type || 'application/octet-stream');

  log('1) POST /api/upload …');
  const r1 = await fetch('/api/upload', { method: 'POST', body: fd });
  log('   HTTP', r1.status);
  const j1 = await r1.json().catch(()=> ({}));
  log(JSON.stringify(j1, null, 2));

  // 2) /api/extract (se ho url dal passo 1)
  if (j1 && j1.url) {
    log('\n2) POST /api/extract …');
    const r2 = await fetch('/api/extract', {
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ fileUrl: j1.url, fileName: file.name })
    });
    log('   HTTP', r2.status);
    const j2 = await r2.json().catch(()=> ({}));
    log(JSON.stringify(j2, null, 2));
  }
};
</script>
